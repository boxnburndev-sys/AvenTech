const I18N = {
  nl: {
    nav_home: "Home",
    nav_services: "Diensten",
    nav_partners: "Partners",
    nav_clients: "Klanten",
    nav_contact: "Contact",
    nav_quote: "Offerte aanvragen",

    home_title: "Websites en digitale ondersteuning, strak en professioneel.",
    home_sub: "We bouwen en onderhouden websites, maken grafisch ontwerp en zetten systemen op voor aanvragen, workflows en integraties.",
    home_cta_contact: "Contact",
    home_cta_services: "Diensten",
    home_cta_clients: "Klanten",

    home_f1_t: "Website bouwen",
    home_f1_d: "Nieuwe site of landingpage die snel laadt en goed overkomt.",
    home_f2_t: "Onderhoud",
    home_f2_d: "Updates, backups en snelle aanpassingen zonder gedoe.",
    home_f3_t: "Design & systemen",
    home_f3_d: "Logo’s, visuals, formulieren en integraties voor je workflow.",

    home_how_title: "Werkwijze",
    home_how_sub: "Kort, duidelijk en met vaste stappen.",
    home_step1_t: "1. Intake",
    home_step1_d: "Doel, doelgroep en wat het moet opleveren.",
    home_step2_t: "2. Voorstel",
    home_step2_d: "Scope, timing en prijs in één overzicht.",
    home_step3_t: "3. Oplevering",
    home_step3_d: "Live, testen en daarna support of doorontwikkeling.",

    home_bottom_t: "Plan iets in",
    home_bottom_d: "Stuur je vraag en we reageren met de volgende stappen.",

    services_title: "Diensten",
    services_desc: "Van website tot onderhoud, van visuals tot systemen. Kies wat je nodig hebt.",
    services_web_t: "Websites",
    services_web_p: "Design + Build",
    services_web_1_t: "Bedrijfssites",
    services_web_1_d: "Professioneel, snel en mobielvriendelijk.",
    services_web_2_t: "Landingspagina’s",
    services_web_2_d: "Voor campagnes en leadgeneratie.",
    services_web_3_t: "Redesign",
    services_web_3_d: "Nieuwe look en betere structuur voor je bestaande site.",

    services_maint_t: "Onderhoud",
    services_maint_p: "Maandelijks",
    services_maint_1_t: "Updates",
    services_maint_1_d: "Content en technische updates zonder vertraging.",
    services_maint_2_t: "Backups",
    services_maint_2_d: "Regelmatige backups en herstelplan.",
    services_maint_3_t: "Fixes",
    services_maint_3_d: "Snel oplossen van kleine issues en bugs.",

    services_design_t: "Grafisch ontwerp",
    services_design_p: "Brand + Visuals",
    services_design_1_t: "Logo & huisstijl",
    services_design_1_d: "Basis voor een consistente uitstraling.",
    services_design_2_t: "Social visuals",
    services_design_2_d: "Templates en posts die je kan hergebruiken.",
    services_design_3_t: "Marketing",
    services_design_3_d: "Banners, flyers, PDF’s en drukwerkbestanden.",

    services_sys_t: "Systemen",
    services_sys_p: "Workflows",
    services_sys_1_t: "Formulieren",
    services_sys_1_d: "Intake, aanvragen en opvolging.",
    services_sys_2_t: "Integraties",
    services_sys_2_d: "Koppelingen met tools die je al gebruikt.",
    services_sys_3_t: "Dashboards",
    services_sys_3_d: "Overzicht en rapportering.",

    services_cta_t: "Even afstemmen?",
    services_cta_d: "Stuur je vraag door en we maken het concreet.",
    services_cta_contact: "Contact",
    services_cta_partners: "Klanten",

    partners_title: "Klanten",
    partners_desc: "Actuele klanten en eerdere projecten. Deze lijst wordt automatisch bijgewerkt.",
    partners_overview: "Overzicht",
    partners_live: "Live",
    partners_current: "Actueel",
    partners_past: "Eerder",
    partners_status_loading: "Laden…",
    partners_status_ok: "Klaar. Klanten zijn bijgewerkt.",
    partners_status_bad: "Niet gelukt. Controleer de API en SeaTable instellingen.",
    partners_btn_site: "Website",

    clients_title: "Klanten",
    clients_desc: "Een selectie van klanten en projecten. Automatisch geladen uit de database.",
    clients_overview: "Overzicht",
    clients_live: "Live",
    clients_list: "Klanten",
    clients_status_loading: "Laden…",
    clients_status_ok: "Klaar. Klanten zijn bijgewerkt.",
    clients_status_bad: "Niet gelukt. Controleer de API en SeaTable instellingen.",
    clients_btn_site: "Website",

    contact_title: "Contact opnemen",
    contact_desc: "Stuur je vraag of projectinfo. We reageren meestal binnen 1 werkdag.",
    contact_form: "Formulier",
    contact_info: "Gegevens",
    contact_quick: "Snel contact",
    contact_status: "Vul het formulier in en verzend je bericht.",
    contact_name: "Naam",
    contact_email: "E-mail",
    contact_company: "Bedrijf",
    contact_about: "Waarover gaat het?",
    contact_budget: "Budget (optioneel)",
    contact_timing: "Timing (optioneel)",
    contact_message: "Bericht",
    contact_hint: "Hoe concreter je vraag, hoe sneller we een duidelijke offerte kunnen maken.",
    contact_send: "Verzenden",
    contact_way: "Werkwijze",
    contact_way_d: "Korte intake, voorstel, start. Duidelijk en professioneel.",
    contact_note: "Wil je een korte call? Zet je beschikbaarheid in je bericht.",
    contact_services_btn: "Diensten bekijken",
    contact_partners_btn: "Klanten",

    privacy_title: "Privacy",
    privacy_desc: "Hoe we met gegevens omgaan, volgens de AVG (GDPR) en Belgische regels.",
    privacy_intro_html: "<b>Samenvatting:</b> we verwerken alleen gegevens die je zelf invult in het contactformulier. We verkopen geen data.",
    privacy_controller_t: "Verwerkingsverantwoordelijke",
    privacy_controller_html: "Aven Technologies<br>Contact: <b>info@aventechnologies.be</b>",
    privacy_data_t: "Welke gegevens verwerken we?",
    privacy_data_html: "Gegevens die je zelf doorstuurt via het contactformulier (bv. naam, e-mail, bedrijf, inhoud van je bericht).",
    privacy_purpose_t: "Doeleinden & rechtsgrond",
    privacy_purpose_html: "We gebruiken je gegevens om je aanvraag te behandelen, contact op te nemen en eventueel een offerte/voorstel op te maken.<br>Rechtsgrond: <b>gerechtvaardigd belang</b> (communicatie met (potentiële) klanten) en/of <b>uitvoering van precontractuele stappen</b> wanneer je om een offerte vraagt.",
    privacy_retention_t: "Bewaartermijn",
    privacy_retention_html: "Contactaanvragen bewaren we maximaal <b>24 maanden</b> voor opvolging. Offertes/administratieve communicatie kan langer bewaard worden indien nodig voor boekhouding of geschillen.",
    privacy_processors_t: "Ontvangers & verwerkers",
    privacy_processors_html: "We delen je gegevens alleen waar nodig:<br><b>Web3Forms</b> (verzenden van het contactformulier),<br><b>Vercel</b> (hosting van de website),<br><b>SeaTable</b> (database voor klantenlijst, indien actief).<br>We geven geen gegevens door aan derden voor marketing.",
    privacy_transfers_t: "Doorgifte buiten de EER",
    privacy_transfers_html: "Sommige dienstverleners kunnen gegevens buiten de EER verwerken. In dat geval gebeuren doorgiftes via passende waarborgen (bv. standaardcontractbepalingen) volgens de AVG.",
    privacy_rights_t: "Jouw rechten",
    privacy_rights_html: "Je hebt recht op inzage, verbetering, verwijdering, beperking, bezwaar en overdraagbaarheid (waar van toepassing).<br>Je kan je rechten uitoefenen via <b>info@aventechnologies.be</b>.",
    privacy_complaint_t: "Klacht",
    privacy_complaint_html: "Je kan een klacht indienen bij de <b>Gegevensbeschermingsautoriteit</b> (België) als je vindt dat je rechten niet gerespecteerd worden.",
    privacy_cookies_t: "Cookies & tracking",
    privacy_cookies_html: "Deze website plaatst <b>geen marketing- of trackingcookies</b> en gebruikt geen cookiebanner.<br>Als we in de toekomst niet-strikt noodzakelijke cookies zouden gebruiken, vragen we eerst toestemming volgens de Belgische e-privacyregels.",
    privacy_storage_t: "Lokale opslag",
    privacy_storage_html: "We gebruiken enkel <b>lokale opslag</b> in je browser om je taalkeuze (NL/EN) te onthouden. Dit is geen tracking.",
    privacy_update_html: "Laatst bijgewerkt: <b>2026-01-16</b>"
  },

  en: {
    nav_home: "Home",
    nav_services: "Services",
    nav_partners: "Partners",
    nav_clients: "Clients",
    nav_contact: "Contact",
    nav_quote: "Request a quote",

    home_title: "Websites and digital support, clean and professional.",
    home_sub: "We build and maintain websites, deliver graphic design, and set up systems for requests, workflows and integrations.",
    home_cta_contact: "Contact",
    home_cta_services: "Services",
    home_cta_clients: "Clients",

    home_f1_t: "Website build",
    home_f1_d: "A new website or landing page that loads fast and looks sharp.",
    home_f2_t: "Maintenance",
    home_f2_d: "Updates, backups and quick changes without hassle.",
    home_f3_t: "Design & systems",
    home_f3_d: "Logos, visuals, forms and integrations for your workflow.",

    home_how_title: "How we work",
    home_how_sub: "Short, clear, and structured.",
    home_step1_t: "1. Intake",
    home_step1_d: "Goals, audience and expected outcome.",
    home_step2_t: "2. Proposal",
    home_step2_d: "Scope, timeline and pricing in one overview.",
    home_step3_t: "3. Delivery",
    home_step3_d: "Go live, test, then support or iterate.",

    home_bottom_t: "Let’s start",
    home_bottom_d: "Send your request and we’ll respond with next steps.",

    services_title: "Services",
    services_desc: "From websites to maintenance, from visuals to systems. Pick what you need.",
    services_web_t: "Websites",
    services_web_p: "Design + Build",
    services_web_1_t: "Business sites",
    services_web_1_d: "Professional, fast and mobile-friendly.",
    services_web_2_t: "Landing pages",
    services_web_2_d: "For campaigns and lead generation.",
    services_web_3_t: "Redesign",
    services_web_3_d: "A fresh look and a better structure for your current site.",

    services_maint_t: "Maintenance",
    services_maint_p: "Monthly",
    services_maint_1_t: "Updates",
    services_maint_1_d: "Content and technical updates without delay.",
    services_maint_2_t: "Backups",
    services_maint_2_d: "Regular backups and a recovery plan.",
    services_maint_3_t: "Fixes",
    services_maint_3_d: "Quick fixes for small issues and bugs.",

    services_design_t: "Graphic design",
    services_design_p: "Brand + Visuals",
    services_design_1_t: "Logo & identity",
    services_design_1_d: "A solid base for consistent branding.",
    services_design_2_t: "Social visuals",
    services_design_2_d: "Reusable templates and posts.",
    services_design_3_t: "Marketing",
    services_design_3_d: "Banners, flyers, PDFs and print-ready files.",

    services_sys_t: "Systems",
    services_sys_p: "Workflows",
    services_sys_1_t: "Forms",
    services_sys_1_d: "Intake, requests and follow-up.",
    services_sys_2_t: "Integrations",
    services_sys_2_d: "Connect the tools you already use.",
    services_sys_3_t: "Dashboards",
    services_sys_3_d: "Overview and reporting.",

    services_cta_t: "Want to align?",
    services_cta_d: "Send your request and we’ll make it concrete.",
    services_cta_contact: "Contact",
    services_cta_partners: "Clients",

    partners_title: "Clients",
    partners_desc: "Current clients and previous projects. Automatically updated from the database.",
    partners_overview: "Overview",
    partners_live: "Live",
    partners_current: "Current",
    partners_past: "Previous",
    partners_status_loading: "Loading…",
    partners_status_ok: "Done. Clients updated.",
    partners_status_bad: "Failed. Check the API and SeaTable settings.",
    partners_btn_site: "Website",

    clients_title: "Clients",
    clients_desc: "A selection of clients and projects. Automatically loaded from the database.",
    clients_overview: "Overview",
    clients_live: "Live",
    clients_list: "Clients",
    clients_status_loading: "Loading…",
    clients_status_ok: "Done. Clients updated.",
    clients_status_bad: "Failed. Check the API and SeaTable settings.",
    clients_btn_site: "Website",

    contact_title: "Contact",
    contact_desc: "Send your request or project details. We usually respond within 1 business day.",
    contact_form: "Form",
    contact_info: "Details",
    contact_quick: "Quick contact",
    contact_status: "Fill in the form and send your message.",
    contact_name: "Name",
    contact_email: "Email",
    contact_company: "Company",
    contact_about: "What is it about?",
    contact_budget: "Budget (optional)",
    contact_timing: "Timing (optional)",
    contact_message: "Message",
    contact_hint: "The more specific, the faster we can send a clear proposal.",
    contact_send: "Send",
    contact_way: "Process",
    contact_way_d: "Short intake, proposal, start. Clear and professional.",
    contact_note: "Want a short call? Add your availability in the message.",
    contact_services_btn: "View services",
    contact_partners_btn: "Clients",

    privacy_title: "Privacy",
    privacy_desc: "How we handle data, in line with GDPR and Belgian rules.",
    privacy_intro_html: "<b>Summary:</b> we only process the data you submit through the contact form. We do not sell data.",
    privacy_controller_t: "Data controller",
    privacy_controller_html: "Aven Technologies<br>Contact: <b>info@aventechnologies.be</b>",
    privacy_data_t: "What data do we process?",
    privacy_data_html: "Data you submit via the contact form (e.g., name, email, company, message content).",
    privacy_purpose_t: "Purposes & legal basis",
    privacy_purpose_html: "We use your data to handle your request, contact you, and optionally prepare a quote/proposal.<br>Legal basis: <b>legitimate interests</b> (communication with (prospective) clients) and/or <b>pre-contractual steps</b> when you request a quote.",
    privacy_retention_t: "Retention",
    privacy_retention_html: "Contact requests are kept for up to <b>24 months</b> for follow-up. Quotes/administrative communication may be retained longer when required for accounting or disputes.",
    privacy_processors_t: "Recipients & processors",
    privacy_processors_html: "We only share data where needed:<br><b>Web3Forms</b> (contact form delivery),<br><b>Vercel</b> (website hosting),<br><b>SeaTable</b> (clients list database, if enabled).<br>We do not share data with third parties for marketing.",
    privacy_transfers_t: "Transfers outside the EEA",
    privacy_transfers_html: "Some providers may process data outside the EEA. Where applicable, transfers are protected through appropriate safeguards (e.g., Standard Contractual Clauses) under GDPR.",
    privacy_rights_t: "Your rights",
    privacy_rights_html: "You have the right to access, rectification, deletion, restriction, objection, and portability (where applicable).<br>Exercise your rights via <b>info@aventechnologies.be</b>.",
    privacy_complaint_t: "Complaint",
    privacy_complaint_html: "You can file a complaint with the <b>Belgian Data Protection Authority</b> if you believe your rights are not respected.",
    privacy_cookies_t: "Cookies & tracking",
    privacy_cookies_html: "This website uses <b>no marketing or tracking cookies</b> and does not use a cookie banner.<br>If we ever add non-essential cookies, we will ask for consent first under Belgian e-privacy rules.",
    privacy_storage_t: "Local storage",
    privacy_storage_html: "We only use <b>local storage</b> in your browser to remember your language choice (NL/EN). This is not tracking.",
    privacy_update_html: "Last updated: <b>2026-01-16</b>"
  }
};

function getLang() {
  const v = localStorage.getItem("lang");
  return v === "en" ? "en" : "nl";
}

function setLang(lang) {
  localStorage.setItem("lang", lang === "en" ? "en" : "nl");
}

function applyI18n() {
  const lang = getLang();
  const dict = I18N[lang] || I18N.nl;

  document.documentElement.setAttribute("lang", lang);

  document.querySelectorAll("[data-i18n]").forEach((el) => {
    const key = el.getAttribute("data-i18n");
    const val = dict[key];
    if (typeof val === "string") el.textContent = val;
  });

  document.querySelectorAll("[data-i18n-html]").forEach((el) => {
    const key = el.getAttribute("data-i18n-html");
    const val = dict[key];
    if (typeof val === "string") el.innerHTML = val;
  });

  document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
    const key = el.getAttribute("data-i18n-placeholder");
    const val = dict[key];
    if (typeof val === "string") el.setAttribute("placeholder", val);
  });

  const langBtn = document.querySelector("[data-lang-toggle]");
  if (langBtn) langBtn.textContent = lang === "en" ? "NL" : "EN";
}

function setupLangToggle() {
  const btn = document.querySelector("[data-lang-toggle]");
  if (!btn) return;
  btn.addEventListener("click", () => {
    setLang(getLang() === "en" ? "nl" : "en");
    applyI18n();
    updatePartnersUiLanguage();
  });
}

function setupActiveNav() {
  const page = document.body.getAttribute("data-page") || "";
  document.querySelectorAll("[data-nav]").forEach((a) => {
    if ((a.getAttribute("data-nav") || "") === page) a.classList.add("active");
  });
}

function setupMobileMenu() {
  const btn = document.querySelector("[data-mobile-toggle]");
  const panel = document.querySelector("[data-mobile-panel]");
  if (!btn || !panel) return;
  btn.addEventListener("click", () => {
    panel.classList.toggle("open");
    btn.setAttribute("aria-expanded", panel.classList.contains("open") ? "true" : "false");
  });
  panel.querySelectorAll("a").forEach((a) => a.addEventListener("click", () => panel.classList.remove("open")));
}

function setYear() {
  const y = document.getElementById("y");
  if (y) y.textContent = new Date().getFullYear();
}

function setupContactForm() {
  const form = document.querySelector("[data-web3form]");
  if (!form) return;

  const keyInput = form.querySelector('input[name="access_key"]');
  const status = document.querySelector("[data-form-status]");
  const btn = form.querySelector('button[type="submit"]');

  const accessKey = keyInput?.value?.trim();
  if (!accessKey || accessKey === "PLAK_HIER_JE_WEB3FORMS_SLEUTEL") {
    if (status) {
      status.className = "notice bad";
      status.innerHTML = getLang() === "en"
        ? "<b>Setup:</b> Add your Web3Forms access key to activate the form."
        : "<b>Instellen:</b> Voeg je Web3Forms access key toe om het formulier te activeren.";
    }
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!status) return;

    status.className = "notice";
    status.textContent = getLang() === "en" ? "Sending…" : "Verzenden…";
    if (btn) { btn.disabled = true; btn.style.opacity = ".85"; }

    const payload = new FormData(form);

    try {
      const res = await fetch("https://api.web3forms.com/submit", { method: "POST", body: payload });
      const data = await res.json();
      if (data.success) {
        status.className = "notice ok";
        status.innerHTML = getLang() === "en"
          ? "<b>Sent.</b> We will contact you soon."
          : "<b>Verzonden.</b> We nemen snel contact op.";
        form.reset();
      } else {
        status.className = "notice bad";
        status.innerHTML = getLang() === "en"
          ? "<b>Failed.</b> Please try again."
          : "<b>Niet gelukt.</b> Probeer opnieuw of stuur ons een e-mail.";
      }
    } catch (err) {
      status.className = "notice bad";
      status.innerHTML = getLang() === "en"
        ? "<b>Network error.</b> Please try again."
        : "<b>Netwerkfout.</b> Probeer opnieuw of stuur ons een e-mail.";
    } finally {
      if (btn) { btn.disabled = false; btn.style.opacity = "1"; }
    }
  });
}

function el(tag, attrs = {}, children = []) {
  const node = document.createElement(tag);
  Object.entries(attrs).forEach(([k, v]) => {
    if (k === "class") node.className = v;
    else if (k === "html") node.innerHTML = v;
    else node.setAttribute(k, v);
  });
  children.forEach((c) => node.appendChild(typeof c === "string" ? document.createTextNode(c) : c));
  return node;
}

function normalizeTagList(raw) {
  if (!raw) return [];
  if (Array.isArray(raw)) return raw.map(String).filter(Boolean);
  return String(raw).split(",").map((s) => s.trim()).filter(Boolean);
}

function normalizeUrl(u) {
  const s = String(u || "").trim();
  if (!s) return "";
  if (s.startsWith("http://") || s.startsWith("https://")) return s;
  return `https://${s}`;
}

function pickFirstImageUrl(raw) {
  if (!raw) return "";
  if (typeof raw === "string") return raw.trim();
  if (Array.isArray(raw)) {
    const first = raw[0];
    if (!first) return "";
    if (typeof first === "string") return first.trim();
    if (typeof first === "object") return String(first.url || first.download_link || first.link || first.src || "").trim();
    return "";
  }
  if (typeof raw === "object") return String(raw.url || raw.download_link || raw.link || raw.src || "").trim();
  return "";
}

function isGraphicalWork(type) {
  const t = String(type || "").trim().toLowerCase();
  return t === "graphical work" || t === "grafisch werk" || t === "grafisch" || t === "design";
}

function renderPartnerCard(row, opts) {
  const name = (row.Naam || row.name || row.Name || "Klant").toString().trim() || "Klant";
  const description = (row.Beschrijving || row.description || row.Description || "").toString().trim();
  const websiteRaw = row.Website || row.website || row.URL || row.url || "";
  const website = normalizeUrl(websiteRaw);
  const status = (row.Status || row.status || "").toString().trim();
  const type = (row.Type || row.type || "").toString().trim();
  const tags = normalizeTagList(row.Tags || row.tags || row.labels || row.Labels);
  const imageUrl = pickFirstImageUrl(row.Image || row.image);

  const card = el("div", { class: "partner" }, [
    el("h4", {}, [name])
  ]);

  if (description) card.appendChild(el("p", {}, [description]));

  const tagWrap = el("div", { class: "tags" }, []);
  if (opts?.showStatus && status) tagWrap.appendChild(el("span", { class: "tag" }, [status]));
  if (type) tagWrap.appendChild(el("span", { class: "tag" }, [type]));
  tags.forEach((t) => tagWrap.appendChild(el("span", { class: "tag" }, [String(t)])));
  if ((opts?.showStatus && status) || type || tags.length) card.appendChild(tagWrap);

  if (isGraphicalWork(type) && imageUrl) {
    card.appendChild(
      el("img", {
        src: imageUrl,
        alt: name,
        style: "width:100%;border-radius:12px;border:1px solid var(--stroke);background:rgba(255,255,255,.04)"
      })
    );
  }

  if (website) {
    const dict = I18N[getLang()] || I18N.nl;
    const label = dict.partners_btn_site || "Website";
    card.appendChild(
      el("a", {
        class: "btn",
        href: website,
        target: "_blank",
        rel: "noopener noreferrer"
      }, [label])
    );
  }

  return card;
}

let lastPartnersPayload = null;
let lastPartnersMode = null;

function updatePartnersUiLanguage() {
  const lang = getLang();
  const dict = I18N[lang] || I18N.nl;

  const partnersRoot = document.querySelector("[data-partners]");
  if (partnersRoot) {
    const statusEl = document.querySelector("[data-partners-status]");
    const state = statusEl?.getAttribute("data-state") || "";
    if (statusEl) {
      if (state === "loading") statusEl.textContent = dict.partners_status_loading;
      if (state === "ok") statusEl.innerHTML = `<b>${dict.partners_status_ok}</b>`;
      if (state === "bad") statusEl.innerHTML = `<b>${dict.partners_status_bad}</b>`;
    }
  }

  if (lastPartnersPayload && lastPartnersMode === "partners") renderPartnersSections(lastPartnersPayload);
}

function filterNonEmptyRows(rowsRaw) {
  return rowsRaw.filter((r) => String(r.Naam || r.name || r.Name || "").trim().length > 0);
}

function renderPartnersSections(rows) {
  const root = document.querySelector("[data-partners]");
  const statusEl = document.querySelector("[data-partners-status]");
  const currentWrap = document.querySelector("[data-partners-current]");
  const pastWrap = document.querySelector("[data-partners-past]");
  if (!root || !currentWrap || !pastWrap) return;

  const currentValue = root.getAttribute("data-current-value") || "Online";
  const pastValue = root.getAttribute("data-past-value") || "Offline";

  const current = [];
  const past = [];

  rows.forEach((r) => {
    const kind = String(r.Status || r.status || "").trim();
    if (kind.toLowerCase() === currentValue.toLowerCase()) current.push(r);
    else if (kind.toLowerCase() === pastValue.toLowerCase()) past.push(r);
    else current.push(r);
  });

  currentWrap.innerHTML = "";
  pastWrap.innerHTML = "";

  current.forEach((r) => currentWrap.appendChild(renderPartnerCard(r, { showStatus: true })));
  past.forEach((r) => pastWrap.appendChild(renderPartnerCard(r, { showStatus: true })));

  const dict = I18N[getLang()] || I18N.nl;
  if (statusEl) {
    statusEl.className = "notice ok";
    statusEl.setAttribute("data-state", "ok");
    statusEl.innerHTML = `<b>${dict.partners_status_ok}</b>`;
  }
}

async function loadRowsFromApi() {
  const res = await fetch("/api/partners", { method: "GET" });
  if (!res.ok) throw new Error("API error");
  const data = await res.json();
  const rowsRaw = Array.isArray(data?.rows) ? data.rows : [];
  return filterNonEmptyRows(rowsRaw);
}

async function setupPartnersPage() {
  const root = document.querySelector("[data-partners]");
  if (!root) return;
  lastPartnersMode = "partners";

  const statusEl = document.querySelector("[data-partners-status]");
  const dict = I18N[getLang()] || I18N.nl;

  try {
    if (statusEl) {
      statusEl.className = "notice";
      statusEl.setAttribute("data-state","loading");
      statusEl.textContent = dict.partners_status_loading;
    }
    const rows = await loadRowsFromApi();
    lastPartnersPayload = rows;
    renderPartnersSections(rows);
  } catch (e) {
    if (statusEl) {
      statusEl.className = "notice bad";
      statusEl.setAttribute("data-state","bad");
      statusEl.innerHTML = `<b>${dict.partners_status_bad}</b>`;
    }
  }
}

setupActiveNav();
setupMobileMenu();
setupLangToggle();
applyI18n();
setupContactForm();
setupPartnersPage();
setYear();
